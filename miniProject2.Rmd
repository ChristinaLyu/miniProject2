---
title: "miniPorject2"
author: "Christina Ly & Caroline Li"
date: "3/7/2018"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r percentage}
joined <- 
  committees %>%
  left_join(contributions, by = "cmte_id")

group_id <-
  joined %>%
  group_by(cmte_id, cmte_state) %>%
  summarise(
    amount = n(),
         same = sum(ifelse(state == cmte_state, 1, 0)),
         diff = amount - same)


```

```{r}
group_summary <-
  group_id %>%
  filter(!is.na(same)) %>%
  group_by(cmte_state) %>%
  summarise(total = sum(amount),
         inState = sum(same),
         outState = sum(diff), 
         percentageIn = inState / total, 
         percentageOut = outState / total)

group_summary 

group_summary %>%
  summarise(all = sum(total),
            inS = sum(inState),
            outS = sum(outState),
            meanIn = inS / all,
            meanOut = outS / all
            )

group_summary %>%
  filter(percentageIn == max(percentageIn) | 
           percentageOut == max(percentageOut))
```

From the result of the dataset, the states have a mean of 15.61% contributions to committees in the same state, and a mean of 84% contributions to other states. Therefore, most states do contribute to committes out of state. From the dataset we can also get the information that most of the contributions in West Virginia are made to committees within the state and all of the contributions in Puerto Rico are made to committees outside the state. 

```{r amount}
percentage <- 
  joined %>%
  group_by(cmte_state) %>%
  mutate(sum = sum(transaction_amt))

percentageIn <- 
  percentage %>%
  filter(cmte_state == state) %>%
  mutate(sumIn = sum(transaction_amt),
         percentageIn = sumIn / sum) %>%
  select(cmte_state, sum, sumIn, percentageIn)

percentageOut <- 
  percentage %>%
  filter(cmte_state != state) %>%
  mutate(sumOut = sum(transaction_amt),
         percentageOut = sumOut / sum) %>%
  select(cmte_state, sum, sumOut, percentageOut)
```

